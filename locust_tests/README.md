# Нагрузочное тестирование API сокращения ссылок

Этот каталог содержит набор скриптов для нагрузочного тестирования API с использованием [Locust](https://locust.io/).

## Предварительные требования

1. Установленный и запущенный API сокращения ссылок (на порту 8000)
2. Установленный Locust в виртуальном окружении проекта:
   ```
   .\.venv\Scripts\pip install locust pandas
   ```

## Структура каталога

- `locustfile.py` - Основной файл с определением сценариев нагрузочного тестирования
- `cache_test.py` - Файл для тестирования эффективности кэширования
- `run_load_tests.py` - Скрипт для запуска автоматических тестов и генерации отчета
- `run_web_ui.py` - Скрипт для запуска интерактивного веб-интерфейса Locust
- `reports/` - Каталог для сохранения отчетов (создается автоматически)

## Сценарии тестирования

### Основной тест (`locustfile.py`)

Имитирует поведение пользователей, выполняющих следующие операции:
- Регистрация и аутентификация
- Создание коротких ссылок (с различными опциями)
- Переход по коротким ссылкам
- Получение статистики
- Обновление ссылок
- Удаление ссылок

### Тест кэширования (`cache_test.py`)

Оценивает эффективность кэширования при доступе к одним и тем же ссылкам:
- Создает тестовые ссылки
- Многократно переходит по одним и тем же ссылкам
- Измеряет время ответа с кэшем и без кэша
- Тестирует инвалидацию кэша при обновлении ссылок

## Запуск тестов

### Автоматический запуск всех тестов

```bash
# Запускает все тесты и генерирует отчеты
.\.venv\Scripts\python locust_tests/run_load_tests.py
```

После выполнения в каталоге `locust_tests/reports/` будут созданы:
- HTML-отчеты для каждого теста
- CSV-файлы с метриками
- Сводный отчет в формате Markdown

### Интерактивный запуск через веб-интерфейс

```bash
# Запуск основного теста
.\.venv\Scripts\python locust_tests/run_web_ui.py

# Запуск теста кэширования
.\.venv\Scripts\python locust_tests/run_web_ui.py cache
```

Это запустит веб-интерфейс Locust на порту 8089. В веб-интерфейсе можно:
- Настроить количество пользователей и скорость их создания
- Запустить и остановить тест
- Отслеживать результаты в реальном времени
- Просматривать графики и метрики

## Настройка параметров тестирования

Для изменения параметров тестирования (количество пользователей, продолжительность и т.д.), отредактируйте константы в начале файла `run_load_tests.py`.

## Интерпретация результатов

После завершения тестов анализируйте HTML-отчеты и сводный отчет:

1. **Общие метрики производительности**:
   - Время отклика (среднее, медиана, 95-й перцентиль)
   - Количество запросов в секунду (RPS)
   - Процент отказов

2. **Эффективность кэширования**:
   - Сравнение времени ответа для запросов с кэшем и без кэша
   - Процентное улучшение благодаря кэшированию

3. **Узкие места**:
   - Эндпоинты с наибольшим временем отклика
   - Операции с наибольшим процентом отказов 